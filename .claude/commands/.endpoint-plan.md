You are an experienced software architect whose task is to create a detailed implementation plan for a REST API endpoint. Your plan will guide the development team in effectively and correctly implementing this endpoint.

Before we begin, review the following information:

1. Route API specification:
<route_api_specification>
### 3.9 Draw Management

#### Validate Draw Feasibility

**Endpoint**: `GET /api/groups/{groupId}/draw/validate`

**Description**: Validate whether a draw can be successfully completed with current participants and exclusion rules. Provides real-time feedback for organizers.

**Authentication**: Required (JWT Bearer token)

**Path Parameters**:
- `groupId` (UUID): Group identifier

**Authorization**: User must be the organizer

**Success Response - Valid** (200 OK):
```json
{
  "groupId": "7c9e6679-7425-40de-944b-e07fc1f90ae7",
  "isValid": true,
  "canDraw": true,
  "participantCount": 5,
  "exclusionRuleCount": 2,
  "errors": [],
  "warnings": []
}
```

**Success Response - Invalid** (200 OK):
```json
{
  "groupId": "7c9e6679-7425-40de-944b-e07fc1f90ae7",
  "isValid": false,
  "canDraw": false,
  "participantCount": 2,
  "exclusionRuleCount": 1,
  "errors": [
    "Minimum 3 participants required for draw",
    "Current exclusion rules prevent valid assignments"
  ],
  "warnings": []
}
```

**Validation Rules**:
- Minimum 3 participants
- Exclusion rules must allow valid assignment graph
- Draw not already completed
- Note: Budget validation not included here as it's provided during draw execution

**Error Responses**:
- `401 Unauthorized`: Missing or invalid token
- `403 Forbidden`: User is not a participant
- `404 Not Found`: Group does not exist

---

#### Execute Draw

**Endpoint**: `POST /api/groups/{groupId}/draw`

**Description**: Execute the Secret Santa draw algorithm. The organizer must provide the final budget when performing the draw. Creates assignments for all participants, sets the final budget, marks draw as completed, and triggers email notifications. This action is irreversible.

**Authentication**: Required (JWT Bearer token)

**Path Parameters**:
- `groupId` (UUID): Group identifier

**Authorization**: User must be the group organizer

**Request Body**:
```json
{
  "budget": 100.00
}
```

**Request Validation**:
- `budget`: Required, NUMERIC(10,2), min 0.01, max 99999999.99

**Pre-execution Validations**:
- User is the organizer
- Draw has not been completed
- Minimum 3 participants
- Exclusion rules allow valid draw
- Budget is provided in request body

**Success Response** (200 OK):
```json
{
  "groupId": "7c9e6679-7425-40de-944b-e07fc1f90ae7",
  "budget": 100.00,
  "drawCompleted": true,
  "drawCompletedAt": "2025-10-20T15:30:00Z",
  "participantCount": 5,
  "assignmentsCreated": 5,
  "emailNotificationsScheduled": 5,
  "myAssignment": {
    "recipientId": "770g0622-g41d-63g6-c938-668877662222",
    "recipientFirstName": "Maria",
    "recipientLastName": "Wiśniewska"
  }
}
```

**Business Logic**:
1. Validate all preconditions including budget in request body
2. Set the final budget: Update Groups.Budget field (transaction)
3. Execute draw algorithm:
   - Each participant assigned exactly one recipient
   - No self-assignments (SantaUserId ≠ RecipientUserId)
   - No 2-person circles (if A→B then B≠A)
   - Respect all exclusion rules
   - Randomized for fairness
4. Create Assignment records in database (transaction)
5. Update Groups.DrawCompletedAt timestamp
6. Schedule DrawCompleted email notifications for all participants
7. Return organizer's own assignment with the final budget (they cannot see others)

**Error Responses**:
- `400 Bad Request`: Validation failed
  ```json
  {
    "error": "ValidationError",
    "message": "Budget is required",
    "details": {
      "budget": ["Budget must be between 0.01 and 99999999.99"]
    }
  }
  ```
  ```json
  {
    "error": "DrawValidationFailed",
    "message": "Cannot execute draw: validation errors found",
    "details": {
      "errors": ["Minimum 3 participants required"]
    }
  }
  ```
  ```json
  {
    "error": "DrawAlreadyCompleted",
    "message": "Draw has already been completed for this group"
  }
  ```
- `401 Unauthorized`: Missing or invalid token
- `403 Forbidden`: User is not the organizer
- `404 Not Found`: Group does not exist
- `500 Internal Server Error`: Draw algorithm failed (should be prevented by validation)
  ```json
  {
    "error": "DrawExecutionFailed",
    "message": "An unexpected error occurred during draw execution. Please contact support."
  }
  ```

---
</route_api_specification>

2. Type definitions:
<type_definitions>
@SantaVibe.Backend\SantaVibe.Api\Data\Entities\
</type_definitions>

3. Tech stack:
<tech_stack>
@docs/tech-stack.md
</tech_stack>

4. Implementation rules:
<implementation_rules>
@docs/backend-guidelines.md
</implementation_rules>

5. Api plan:
<implementation_rules>
@docs/api-plan.md
</implementation_rules>

Your task is to create a comprehensive implementation plan for the REST API endpoint. Before delivering the final plan, use <analysis> tags to analyze the information and outline your approach. In this analysis, ensure that:

1. Summarize key points of the API specification.
2. List required and optional parameters from the API specification.
3. List necessary DTO types and Command Models.
4. Consider how to extract logic to a service (existing or new, if it doesn't exist).
5. Plan input validation according to the API endpoint specification, database resources, and implementation rules.
6. Determine how to log errors in the error table (if applicable).
7. Outline potential error scenarios and corresponding status codes.

After conducting the analysis, create a detailed implementation plan in markdown format. The plan should contain the following sections:

1. Endpoint Overview
2. Request Details
3. Response Details
4. Data Flow
5. Error Handling
6. Implementation Steps

Throughout the plan, ensure that you:
- Use correct API status codes:
  - 200 for successful read
  - 201 for successful creation
  - 400 for invalid input
  - 401 for unauthorized access
  - 404 for not found resources
  - 500 for server-side errors
- Adapt to the provided tech stack
- Follow the provided implementation rules

The final output should be a well-organized implementation plan in markdown format. Here's an example of what the output should look like:

``markdown
# API Endpoint Implementation Plan: [Endpoint Name]

## 1. Endpoint Overview
[Brief description of endpoint purpose and functionality]

## 2. Request Details
- HTTP Method: [GET/POST/PUT/DELETE]
- URL Structure: [URL pattern]
- Parameters:
  - Required: [List of required parameters]
  - Optional: [List of optional parameters]
- Request Body: [Request body structure, if applicable]

## 3. Used Types
[DTOs and Command Models necessary for implementation]

## 3. Response Details
[Expected response structure and status codes]

## 4. Data Flow
[Description of data flow, including interactions with external services or databases]

## 5. Security Considerations
[Authentication, authorization, and data validation details]

## 6. Error Handling
[List of potential errors and how to handle them]

## 7. Performance Considerations
[Potential bottlenecks and optimization strategies]

## 8. Implementation Steps
1. [Step 1]
2. [Step 2]
3. [Step 3]
...
```

The final output should consist solely of the implementation plan in markdown format and should not duplicate or repeat any work done in the analysis section.

Remember to save your implementation plan as docs/api-implementation-plan\{endpoint}-implementation-plan.md. Ensure the plan is detailed, clear, and provides comprehensive guidance for the development team.