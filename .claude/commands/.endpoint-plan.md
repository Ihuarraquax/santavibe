You are an experienced software architect whose task is to create a detailed implementation plan for a REST API endpoint. Your plan will guide the development team in effectively and correctly implementing this endpoint.

Before we begin, review the following information:

1. Route API specification:
<route_api_specification>
### 3.8 Exclusion Rules Management

#### Get Exclusion Rules

**Endpoint**: `GET /api/groups/{groupId}/exclusion-rules`

**Description**: Retrieve all exclusion rules for a group. Available to group organizer only.

**Authentication**: Required (JWT Bearer token)

**Path Parameters**:
- `groupId` (UUID): Group identifier

**Authorization**: User must be the group organizer

**Success Response** (200 OK):
```json
{
  "groupId": "7c9e6679-7425-40de-944b-e07fc1f90ae7",
  "exclusionRules": [
    {
      "ruleId": "1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d",
      "user1": {
        "userId": "550e8400-e29b-41d4-a716-446655440000",
        "firstName": "Jan",
        "lastName": "Kowalski"
      },
      "user2": {
        "userId": "770g0622-g41d-63g6-c938-668877662222",
        "firstName": "Maria",
        "lastName": "Kowalska"
      },
      "createdAt": "2025-10-15T15:00:00Z"
    }
  ],
  "totalCount": 1
}
```

**Error Responses**:
- `401 Unauthorized`: Missing or invalid token
- `403 Forbidden`: User is not a group organizer
- `404 Not Found`: Group does not exist

---

#### Create Exclusion Rule

**Endpoint**: `POST /api/groups/{groupId}/exclusion-rules`

**Description**: Create a new exclusion rule preventing two participants from drawing each other. Only available to organizer before draw.

**Authentication**: Required (JWT Bearer token)

**Path Parameters**:
- `groupId` (UUID): Group identifier

**Authorization**: User must be the group organizer

**Request Body**:
```json
{
  "userId1": "550e8400-e29b-41d4-a716-446655440000",
  "userId2": "770g0622-g41d-63g6-c938-668877662222"
}
```

**Request Validation**:
- `userId1`: Required, must be a participant in the group
- `userId2`: Required, must be a participant in the group
- `userId1` â‰  `userId2` (CHECK constraint)
- Unique combination of (groupId, userId1, userId2)
- Draw must not be completed
- Rule must not make draw impossible (validated in real-time)

**Success Response** (201 Created):
```json
{
  "ruleId": "1a2b3c4d-5e6f-7a8b-9c0d-1e2f3a4b5c6d",
  "groupId": "7c9e6679-7425-40de-944b-e07fc1f90ae7",
  "user1": {
    "userId": "550e8400-e29b-41d4-a716-446655440000",
    "firstName": "Jan",
    "lastName": "Kowalski"
  },
  "user2": {
    "userId": "770g0622-g41d-63g6-c938-668877662222",
    "firstName": "Maria",
    "lastName": "Kowalska"
  },
  "createdAt": "2025-10-15T15:00:00Z",
  "drawValidation": {
    "isValid": true,
    "errors": []
  }
}
```

**Error Responses**:
- `400 Bad Request`: Validation failed
  ```json
  {
    "error": "InvalidExclusionRule",
    "message": "This exclusion rule would make a valid draw impossible",
    "details": {
      "suggestion": "Remove the exclusion between User A and User B to allow valid assignments"
    }
  }
  ```
  ```json
  {
    "error": "SameUser",
    "message": "Cannot create exclusion rule for the same user"
  }
  ```
  ```json
  {
    "error": "DrawAlreadyCompleted",
    "message": "Cannot add exclusion rules after draw has been completed"
  }
  ```
- `401 Unauthorized`: Missing or invalid token
- `403 Forbidden`: User is not the organizer
- `404 Not Found`: Group or user not found
- `409 Conflict`: Duplicate exclusion rule

---

#### Delete Exclusion Rule

**Endpoint**: `DELETE /api/groups/{groupId}/exclusion-rules/{ruleId}`

**Description**: Remove an exclusion rule. Only available to organizer before draw.

**Authentication**: Required (JWT Bearer token)

**Path Parameters**:
- `groupId` (UUID): Group identifier
- `ruleId` (UUID): Exclusion rule identifier

**Authorization**: User must be the group organizer

**Success Response** (204 No Content)

**Error Responses**:
- `400 Bad Request`: Draw already completed
  ```json
  {
    "error": "DrawAlreadyCompleted",
    "message": "Cannot remove exclusion rules after draw has been completed"
  }
  ```
- `401 Unauthorized`: Missing or invalid token
- `403 Forbidden`: User is not the organizer
- `404 Not Found`: Group or rule not found

---

</route_api_specification>

2. Type definitions:
<type_definitions>
@SantaVibe.Backend\SantaVibe.Api\Data\Entities\
</type_definitions>

3. Tech stack:
<tech_stack>
@docs/tech-stack.md
</tech_stack>

4. Implementation rules:
<implementation_rules>
@docs/backend-guidelines.md
</implementation_rules>

5. Api plan:
<implementation_rules>
@docs/api-plan.md
</implementation_rules>

Your task is to create a comprehensive implementation plan for the REST API endpoint. Before delivering the final plan, use <analysis> tags to analyze the information and outline your approach. In this analysis, ensure that:

1. Summarize key points of the API specification.
2. List required and optional parameters from the API specification.
3. List necessary DTO types and Command Models.
4. Consider how to extract logic to a service (existing or new, if it doesn't exist).
5. Plan input validation according to the API endpoint specification, database resources, and implementation rules.
6. Determine how to log errors in the error table (if applicable).
7. Outline potential error scenarios and corresponding status codes.

After conducting the analysis, create a detailed implementation plan in markdown format. The plan should contain the following sections:

1. Endpoint Overview
2. Request Details
3. Response Details
4. Data Flow
5. Error Handling
6. Implementation Steps

Throughout the plan, ensure that you:
- Use correct API status codes:
  - 200 for successful read
  - 201 for successful creation
  - 400 for invalid input
  - 401 for unauthorized access
  - 404 for not found resources
  - 500 for server-side errors
- Adapt to the provided tech stack
- Follow the provided implementation rules

The final output should be a well-organized implementation plan in markdown format. Here's an example of what the output should look like:

``markdown
# API Endpoint Implementation Plan: [Endpoint Name]

## 1. Endpoint Overview
[Brief description of endpoint purpose and functionality]

## 2. Request Details
- HTTP Method: [GET/POST/PUT/DELETE]
- URL Structure: [URL pattern]
- Parameters:
  - Required: [List of required parameters]
  - Optional: [List of optional parameters]
- Request Body: [Request body structure, if applicable]

## 3. Used Types
[DTOs and Command Models necessary for implementation]

## 3. Response Details
[Expected response structure and status codes]

## 4. Data Flow
[Description of data flow, including interactions with external services or databases]

## 5. Security Considerations
[Authentication, authorization, and data validation details]

## 6. Error Handling
[List of potential errors and how to handle them]

## 7. Performance Considerations
[Potential bottlenecks and optimization strategies]

## 8. Implementation Steps
1. [Step 1]
2. [Step 2]
3. [Step 3]
...
```

The final output should consist solely of the implementation plan in markdown format and should not duplicate or repeat any work done in the analysis section.

Remember to save your implementation plan as docs/api-implementation-plan\{endpoint}-implementation-plan.md. Ensure the plan is detailed, clear, and provides comprehensive guidance for the development team.